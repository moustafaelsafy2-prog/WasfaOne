<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WasfaOne — التطبيق</title>

  <!-- Fonts & Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700;800&family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- هوية المشروع -->
  <link rel="stylesheet" href="/public/assets/styles.css" />
  <meta name="color-scheme" content="light dark" />

  <style>
    :root { --primary:#ef4444; --acc1:#10b981; --acc2:#3b82f6; }
    body { font-family:"Cairo", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Inter", sans-serif; }
    .btn { transition:transform .15s ease, box-shadow .15s ease; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 24px rgba(0,0,0,.08); }
    .card { background:white; border-radius:1rem; border:1px solid rgba(148,163,184,.25); }
    @media (prefers-color-scheme: dark){
      .card{ background:#0f172a; border-color:#1f2a44; }
      body{ color:#e2e8f0; background:#0b1220; }
    }
    .lbl{ display:block; font-size:.9rem; margin-bottom:.25rem; opacity:.9 }
    .inp, .sel, .txt{
      width:100%; border:1px solid rgba(148,163,184,.35); border-radius:.6rem;
      background: white; padding:.6rem .75rem; outline: none;
    }
    .txt{ min-height: 110px; resize: vertical; }
    @media (prefers-color-scheme: dark){
      .inp, .sel, .txt { background:#0b1220; border-color:#24324d; color:#e2e8f0; }
    }
    .badge { display:inline-flex; align-items:center; gap:.4rem; font-weight:700; padding:.2rem .6rem; border-radius:.6rem; font-size:.75rem; }
    .badge-trial { background:#fee2e2; color:#991b1b; }
    .badge-month { background:#dcfce7; color:#14532d; }
    .badge-year { background:#dbeafe; color:#1e3a8a; }
    @media (prefers-color-scheme: dark){
      .badge-trial { background:#7f1d1d; color:#fecaca; }
      .badge-month { background:#052e16; color:#86efac; }
      .badge-year { background:#172554; color:#bfdbfe; }
    }
  </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100">

  <!-- Header -->
  <header class="border-b border-slate-200/70 dark:border-slate-800/70 sticky top-0 bg-white/70 dark:bg-slate-900/70 backdrop-blur z-10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img id="logoImg" class="h-9 w-auto" alt="Logo" />
        <h1 id="siteTitle" class="font-extrabold text-lg">WasfaOne</h1>
      </div>
      <nav class="hidden md:flex items-center gap-6">
        <a href="/public/index.html#plans" class="text-sm hover:opacity-80">الخطط</a>
        <a href="/public/privacy.html" class="text-sm hover:opacity-80">الخصوصية</a>
      </nav>
      <div class="flex items-center gap-3">
        <a id="whatsappBtn" href="#" target="_blank" class="btn inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600 text-white text-sm">
          <span>WhatsApp</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Top status -->
  <section class="border-b border-slate-200/70 dark:border-slate-800/70 bg-white/50 dark:bg-slate-900/40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-wrap items-center gap-3">
      <div id="planBadge" class="badge badge-trial">Trial</div>
      <div id="trialInfo" class="text-sm opacity-80"></div>
      <div class="ms-auto flex items-center gap-3">
        <a href="/public/login.html" class="text-sm underline underline-offset-4">تغيير الحساب</a>
      </div>
    </div>
  </section>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- Alerts -->
    <div id="statusBar" class="hidden mb-4 p-3 rounded-md bg-emerald-50 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200 text-sm"></div>
    <div id="errorBar" class="hidden mb-4 p-3 rounded-md bg-rose-50 text-rose-800 dark:bg-rose-900/30 dark:text-rose-200 text-sm"></div>

    <div class="grid md:grid-cols-3 gap-6 items-start">
      <!-- Controls -->
      <section class="md:col-span-1 card p-5">
        <h2 class="text-lg font-extrabold mb-3">إنشاء وصفة</h2>

        <div class="mb-3">
          <label class="lbl" for="mealTypeSelect">نوع الوجبة</label>
          <select id="mealTypeSelect" class="sel">
            <option value="وجبة">وجبة رئيسية</option>
            <option value="حلويات">حلويات</option>
            <option value="سلطة">سلطة</option>
            <option value="شوربة">شوربة</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="lbl" for="cuisineSelect">المطبخ</label>
          <select id="cuisineSelect" class="sel">
            <option value="متوسطي (Mediterranean)">متوسطي</option>
            <option value="شرق أوسطي">شرق أوسطي</option>
            <option value="مطبخ مصري">مصري</option>
            <option value="هندي">هندي</option>
            <option value="أمريكي">أمريكي</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="lbl" for="dietTypeSelect">النظام الغذائي</label>
          <select id="dietTypeSelect" class="sel">
            <option value="balanced">Balanced</option>
            <option value="keto">Keto</option>
            <option value="low_carb">Low Carb</option>
            <option value="high_protein">High Protein</option>
            <option value="high_protein_keto">High Protein Keto</option>
            <option value="dr_mohamed_saeed">نظام د. محمد سعيد</option>
            <option value="mediterranean">Mediterranean</option>
            <option value="vegan">Vegan</option>
            <option value="lchf">LCHF</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="lbl" for="caloriesInput">السعرات المستهدفة (للحصة)</label>
          <input id="caloriesInput" type="number" min="120" max="1200" step="10" class="inp" placeholder="مثال: 500" />
        </div>

        <div class="mb-3">
          <label class="lbl" for="allergiesInput">حساسيات يجب تجنّبها (مفصولة بفواصل)</label>
          <input id="allergiesInput" type="text" class="inp" placeholder="مثال: جلوتين، لاكتوز" />
        </div>

        <div class="mb-4">
          <label class="lbl" for="availableInput">مكوّناتك المتاحة (اختياري)</label>
          <textarea id="availableInput" class="txt" placeholder="مثال: صدور دجاج، أرز بسمتي، زبادي يوناني"></textarea>
          <p class="text-xs opacity-70 mt-1">سنحاول استخدام هذه المكوّنات بأوزان جرام دقيقة.</p>
        </div>

        <button id="generateBtn" class="btn w-full px-4 py-2 rounded-md bg-[color:var(--primary)] text-white font-bold">
          توليد وصفة
        </button>

        <div class="mt-3 text-xs opacity-70">
          ملاحظة: نلتزم بالجرام 100%، والسعرات تُحسب وفق 4/4/9 لتحقيق تطابق دقيق.
        </div>
      </section>

      <!-- Output -->
      <section class="md:col-span-2 card p-5">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-extrabold">النتيجة</h2>
          <div class="flex items-center gap-2">
            <a href="/public/index.html#plans" class="text-xs underline underline-offset-4">الترقية والأسعار</a>
            <a id="ctaWhatsApp" href="#" target="_blank" class="text-xs underline underline-offset-4">تواصل عبر واتساب</a>
          </div>
        </div>
        <div id="recipeOut" class="mt-4">
          <div class="text-sm opacity-70">لم يتم توليد وصفة بعد.</div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="mt-10 border-t border-slate-200 dark:border-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-6 text-sm flex items-center justify-between">
      <p id="footerLine">للاشتراك أو التجديد: 00971502061209 — واتساب/اتصال</p>
      <a id="footerWhatsapp" href="#" target="_blank" class="btn px-3 py-1.5 rounded-md bg-green-600 text-white">WhatsApp</a>
    </div>
  </footer>

  <!-- سكربت التطبيق -->
  <script src="/public/assets/app.js"></script>

  <!-- تهيئة هوية الصفحة -->
  <script>
    (async function initBranding(){
      try{
        const r = await fetch("/data/settings.json?ts="+Date.now(), { cache:"no-store" });
        if(!r.ok) return;
        const s = await r.json();
        const wa = s?.contact?.whatsapp_link || "#";
        document.getElementById("logoImg").src = s?.branding?.logo_url || "";
        document.getElementById("logoImg").alt = s?.images_meta?.hero?.alt_ar || "شعار";
        document.getElementById("siteTitle").textContent = s?.branding?.site_name_ar || "وصفة ون";
        document.getElementById("whatsappBtn").href = wa;
        document.getElementById("ctaWhatsApp").href = wa;
        document.getElementById("footerWhatsapp").href = wa;
      }catch(e){ /* ignore */ }
    })();
  </script>
</body>
</html>
